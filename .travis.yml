language: python
cache:
  - pip: true
  - bundler: true
  - node_modules # NPM packages

python:
  - 3.4
  - 3.5
  - 3.6
  - 3.7-dev

services:
  - postgresql

install:
  - pip install -r requirements.txt
  - pip install flake8
  - pip install codecov
  - pip install psycopg2
  - npm install cssmin
  - npm install uglify-js
  - npm install babel-cli babel-plugin-transform-es2015-block-scoping babel-preset-modern-browsers
  - export PATH=$PATH:$PWD/node_modules/.bin/
  - gem install sass

before_script:
  - cp todoscheduler/settings.py.example todoscheduler/settings.py
  - cp vendor/unicode/categories.json categories.json
  - cp vendor/unicode/confusables.json confusables.json
  - psql -c "CREATE USER todoscheduler WITH ENCRYPTED PASSWORD 'todoscheduler' CREATEDB;" -U postgres

script:
  - flake8
  - coverage run manage.py test
  - ./manage.py collectstatic --no-input

after_success:
  - codecov
